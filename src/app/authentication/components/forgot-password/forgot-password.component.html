<div class="forgot-password-container">
  <a class="back-link" routerLink="/auth/login">
    <img src="assets/icon/chevron-back.svg" alt="Back" />
    Back
  </a>

  <div *ngIf="!isEmailSubmitted && !showOtpScreen" class="email-form">
    <h2 class="forgot-password-heading">Forgot password?</h2>
    <p class="forgot-password-subtext">
      Don't worry, happens to all of us. Enter your email below to receive a
      verification code to recover your password.
    </p>

    <form
      [formGroup]="forgotPasswordForm"
      (ngSubmit)="onSubmit()"
      class="forgot-password-form"
    >
      <div class="form-field">
        <label for="email">Email Address</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="Enter mail here"
          [class.invalid]="isFieldInvalid('email')"
        />
        <div class="input-error" *ngIf="isFieldInvalid('email')">
          Please enter a valid email address.
        </div>
      </div>

      <button type="submit" class="submit-button">Submit</button>
    </form>
  </div>

  <div *ngIf="isEmailSubmitted && !showOtpScreen" class="check-mail-screen">
    <img
      src="assets/icon/email-message.svg"
      alt="Email Message"
      class="email-svg"
    />
    <h2 class="check-mail-heading">Check your mail</h2>
    <p class="check-mail-subtext">
      We have sent the verification code to your inbox.
    </p>

    <button class="open-mail-button" (click)="openMailApp()">
      Open mail app
    </button>
    <button class="continue-otp-button" (click)="showOtpForm()">
      Continue to OTP
    </button>

    <p class="resend-instructions">
      Didn't receive mail? Check Spam filter or
      <a href="javascript:void(0)" (click)="resetForm()"
        >Try another Email Address</a
      >
    </p>
  </div>

  <!-- OTP Verification Screen -->
  <div
    *ngIf="showOtpScreen && !verificationSuccessful"
    class="otp-verification-container"
  >
    <h2 class="verification-heading">Verification Code</h2>
    <p class="verification-subtext">
      Enter the verification code that we have sent, kindly check and enter
      here.
    </p>

    <form [formGroup]="otpForm" (ngSubmit)="verifyOtp()" class="otp-form">
      <div class="otp-inputs">
        <ng-container
          *ngFor="let control of otpControls.controls; let i = index"
        >
          <input
            type="text"
            maxlength="1"
            [formControl]="otpControls.at(i)"
            (keyup)="onOtpInput($event)"
            [class.invalid]="verificationFailed"
            placeholder="*"
          />
        </ng-container>
      </div>

      <!-- Error Message -->
      <div *ngIf="verificationFailed" class="error-message-container">
        <div class="error-icon">
          <img src="assets/icon/message-error.svg" alt="Error Icon" />
        </div>
        <div class="error-text">
          <h2>Error</h2>
          <p>The verification code provided is invalid</p>
        </div>
      </div>

      <div class="timer-container">
        <p class="expiry-notice" [class.expired]="timerExpired">
          <ng-container *ngIf="!timerExpired">
            Code expires in <span class="countdown">{{ displayTime }}</span>
          </ng-container>
          <ng-container *ngIf="timerExpired">
            Code expired.
            <a href="javascript:void(0)" (click)="requestNewCode()"
              >Request for new code</a
            >
          </ng-container>
        </p>
      </div>

      <button type="submit" class="verify-button" [disabled]="timerExpired">
        Verify
      </button>
    </form>
  </div>

  <!-- Success Screen message -->
  <div *ngIf="verificationSuccessful" class="success-container">
    <div class="success-message">
      <div class="success-icon">
        <img src="assets/icon/success-icon.svg" alt="Success Icon" />
      </div>
      <div class="success-text">
        <h2>Success</h2>
        <p>Your verification was successful</p>
        <button class="new-password-button" (click)="createNewPassword()">
          Create New Password
        </button>
      </div>
    </div>
  </div>
</div>
